##########################################
#               Note Values              #
# Written in (pitch, start beat, length) #
##########################################
base_chords = {
    "Chainsmokers": {
        1: {
            "midi" : [
                (37,0,2.5), (44,0,2.5), (53,0,2.5), (56,0,2.5), (63,0,2.5),  
                (39,2.5,1.5), (46,2.5,1.5), (55,2.5,1.5), (58,2.5,1.5), (63,2.5,1.5), 
                (41,4,2.5), (48,4,2.5), (56,4,2.5), (60,4,2.5), (63,4,2.5), 
                (39,6.5,1.5), (46,6.5,1.5), (55,6.5,1.5), (58,6.5,1.5), (63,6.5,1.5),

                (37,8,2.5), (44,8,2.5), (53,8,2.5), (56,8,2.5), (63,8,2.5),  
                (39,10.5,1.5), (46,10.5,1.5), (55,10.5,1.5), (58,10.5,1.5), (63,10.5,1.5), 
                (41,12,2.5), (48,12,2.5), (56,12,2.5), (60,12,2.5), (63,12,2.5), 
                (39,14.5,1.5), (46,14.5,1.5), (55,14.5,1.5), (58,14.5,1.5), (63,14.5,1.5)
            ],
            "pitches": [37, 39, 41, 44, 46, 48, 53, 55, 56, 58, 60, 63]
        },
        2: {
            "midi" : [
                (37,0,1), (44,0,1), (53,0,1), (56,0,1), (63,0,1),
                (39,5,1), (46,5,1), (55,5,1), (58,5,1), (63,5,1),
                (39,6,1), (46,6,1), (55,6,1), (58,6,1), (63,6,1),
                (41,8,1), (48,8,1), (56,8,1), (60,8,1), (63,8,1), 
                (39,13,1), (46,13,1), (55,13,1), (58,13,1), (63,13,1),
                (39,14,1), (46,14,1), (55,14,1), (58,14,1), (63,14,1),
                (39,15,1), (46,15,1), (55,15,1), (58,15,1), (63,15,1)
            ],
            "pitches": [37, 39, 41, 44, 46, 48, 53, 55, 56, 58, 60, 63]
        }
    },

    "Ed Sheeran": {
        1: {
            "midi": [
                (37, 0, 2), (40, 0, 2), (44, 0, 2), (48, 0, 2),
                (37, 2, 2), (42, 2, 2), (45, 2, 2), (48, 2, 2),
                (37, 4, 2), (40, 4, 2), (45, 4, 2), (48, 4, 2),
                (39, 6, 2), (42, 6, 2), (47, 6, 2), (48, 6, 2),

                (37, 8, 2), (40, 8, 2), (44, 8, 2), (48, 8, 2),
                (37, 10, 2), (42, 10, 2), (45, 10, 2), (48, 10, 2),
                (37, 12, 2), (40, 12, 2), (45, 12, 2), (48, 12, 2),
                (39, 14, 2), (42, 14, 2), (47, 14, 2), (48, 14, 2)
            ],
            "pitches": [37, 39, 40, 42, 44, 45, 47, 48]
        },
        2: {
            "midi": [
                (45, 0, 2), (48, 0, 2), (52, 0, 2), (57, 0, 2),
                (45, 2, 2), (48, 2, 2), (53, 2, 2), (57, 2, 2),
                (43, 4, 4), (48, 4, 4), (52, 4, 4), (55, 4, 4),

                (45, 8, 2), (48, 8, 2), (52, 8, 2), (57, 8, 2),
                (45, 10, 2), (48, 10, 2), (53, 10, 2), (57, 10, 2),
                (43, 12, 4), (48, 12, 4), (52, 12, 4), (55, 12, 4)
            ],
            "pitches": [43, 45, 48, 52, 53, 55, 57]
        }
    }
}

base_percussion = {
    "Chainsmokers": {
        1: {
            "midi" : [
                (35,0,1), (35,1,1), (38,1,1), (44,1,1), (35,2.5,.5), (44,2.5,.5), (35,3,.5), (44,3,.5),
                (35,4,1), (35,5,1), (38,5,1), (44,5,1), (35,6.5,.5), (44,6.5,.5), (35,7,.5), (44,7,.5),
                (35,8,1), (35,9,1), (38,9,1), (44,9,1), (35,10.5,.5), (44,10.5,.5), (35,11,.5), (44,11,.5),
                (35,12,1), (35,13,1), (38,13,1), (44,13,1), (35,14.5,.5), (44,14.5,.5), (35,15,.5), (44,15,.5)
            ],
            "pitches": [35, 38, 44]
        },
        2: {
            "midi" : [
                (36,0,1), (36,1,1), (38,2,2), (36,4,1), (36,5,1), (36,5.5,.5), (38,6,1), (38,7,1),
                (36,8,1), (36,9,1), (38,10,2), (36,12,1), (36,13,1), (36,13.5,.5), (38,14,1), (38,15,1),
            ],
            "pitches": [36, 38, 52]
        }
    },

    "Ed Sheeran": {
        1: {
            "midi": [
                (35, 0, .5), (38, 0, .75), (52, 0, .75), (38, .75, .25)
                (35, 1, .5), (52, 1, .5), (38, 1.5, .5),
                (35, 2, .5), (38, 2, .75), (52, 2, .75), (38, 2.75, .25)
                (35, 3, .5), (52, 3, .5), (38, 3.5, .5),

                (35, 4, .5), (38, 4, .75), (52, 4, .75), (38, 4.75, .25)
                (35, 5, .5), (52, 5, .5), (38, 5.5, .5),
                (35, 6, .5), (38, 6, .75), (52, 6, .75), (38, 6.75, .25)
                (35, 7, .5), (52, 7, .5), (38, 7.5, .5),

                (35, 8, .5), (38, 8, .75), (52, 8, .75), (38, 8.75, .25)
                (35, 9, .5), (52, 9, .5), (38, 9.5, .5),
                (35, 10, .5), (38, 10, .75), (52, 10, .75), (38, 10.75, .25)
                (35, 11, .5), (52, 11, .5), (38, 11.5, .5),

                (35, 12, .5), (38, 12, .75), (52, 12, .75), (38, 12.75, .25)
                (35, 13, .5), (52, 13, .5), (38, 13.5, .5),
                (35, 14, .5), (38, 14, .75), (52, 14, .75), (38, 14.75, .25)
                (35, 15, .5), (52, 15, .5), (38, 15.5, .5),
            ],
            "pitches": [35, 38, 52]
        },
        2: {
            "midi": [
                (35, 0, 1), (44, 0, .5), (44, 0.5, .25), (44, 0.75, .25),
                (35, 1, 1), (44, 1, .5), (44, 1.5, .25), (44, 1.75, .25),
                (35, 2, 1), (44, 2, .5), (44, 2.5, .25), (44, 2.75, .25),
                (35, 3, 1), (44, 3, .5), (44, 3.5, .25), (44, 3.75, .25),

                (35, 4, 1), (44, 4, .5), (44, 4.5, .25), (44, 4.75, .25),
                (35, 5, 1), (44, 5, .5), (44, 5.5, .25), (44, 5.75, .25),
                (35, 6, 1), (44, 6, .5), (44, 6.5, .25), (44, 6.75, .25),
                (35, 7, 1), (44, 7, .5), (44, 7.5, .25), (44, 7.75, .25),

                (35, 8, 1), (44, 8, .5), (44, 8.5, .25), (44, 8.75, .25),
                (35, 9, 1), (44, 9, .5), (44, 9.5, .25), (44, 9.75, .25),
                (35, 10, 1), (44, 10, .5), (44, 10.5, .25), (44, 10.75, .25),
                (35, 11, 1), (44, 11, .5), (44, 11.5, .25), (44, 11.75, .25),

                (35, 12, 1), (44, 12, .5), (44, 12.5, .25), (44, 12.75, .25),
                (35, 13, 1), (44, 13, .5), (44, 13.5, .25), (44, 13.75, .25),
                (35, 14, 1), (44, 14, .5), (44, 14.5, .25), (44, 14.75, .25),
                (35, 15, 1), (44, 15, .5), (44, 15.5, .25), (44, 15.75, .25),
            ],
            "pitches": [35, 44]
        }
    }
}
'''
base_melody = {
    "Chainsmokers": {
        1: {
            "changes": [(0, 16, [63,68,70,72,75])],
            "pitches": [63,68,70,72,75]
        }
    }
}
A-flat major
68,70,72,73,75,77,79,80
56,58,60,61,63,65,67,68
'''
base_melody = {
    "Chainsmokers": {
        1: {
            "changes": [(0, 16, [63,68,70,72,75])],
            "pitches": [56,58,60,61,63,65,67,68]
        }
    },
    "Ed Sheeran": {
        1: {
            "changes": [(0, 16, [60, 64, 65, 67, 71])],
            "pitches": [49, 51, 52, 54, 56, 57, 59, 60, 61, 63, 64, 66, 68, 69]
        }
    },
}

tempos = {
    "Chainsmokers": 95*2
}

def transpose_instrument(style, instrument, transposition):
    if instrument == "chords":
        data = base_chords[style]
    else: # instrument is percussion
        data = base_percussion[style]

    output = {}
    for option in data:
        midi = []
        pitches = []

        for noteset in data[option]["midi"]:
            pitch = noteset[0] + transposition
            midi.append((pitch, noteset[1], noteset[2]))

        for pitch in data[option]["pitches"]:
            pitches.append(pitch + transposition)

        output[option] = {
            "midi": midi,
            "pitches": pitches
        }

    return output

def transpose_melody(style, option, transposition):
    data = base_melody[style][option]
    changes = []
    pitches = []

    for pitch in data["pitches"]:
        pitches.append(pitch + transposition)
    
    changes.append((data["changes"][0][0], data["changes"][0][1], pitches))
    
    return {
        "changes": changes,
        "pitches": pitches
    }

def chords_to_changes(chords):
    data = chords["midi"] #[(pitch, startBeat, len)]
    output = [] #[(startBeat, len, [allowed pitches])]
    currentStartBeat = None
    allNotes = []
    for note in data:
        if note[0] not in allNotes:
            allNotes.append(note[0])
        if currentStartBeat == None:
            currentStartBeat = note[1]
            output.append((note[1], note[2], []))
        if note[1] == currentStartBeat:
            if note[0] not in output[-1][2]:
                output[-1][2].append(note[0])
        else:
            currentStartBeat = note[1]
            output.append((note[1], note[2], [note[0]]))
    #print("CHORD TO CHANGES output: ",output)
    return (output, allNotes)

def combine_changes_and_scale(changeNotes, scaleNotes):
    changeSet = set(changeNotes)
    scaleSet = set(scaleNotes)

    combinedSet = changeSet | scaleSet
    combinedList = list(combinedSet)
    combinedList.sort()
    return combinedList
